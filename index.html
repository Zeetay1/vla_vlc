<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Positivity Summit Check-In</title>
  <script src="https://unpkg.com/html5-qrcode"></script>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }
    #reader { width: 300px; margin: 0 auto; }
    #result { margin-top: 20px; font-size: 1.2em; font-weight: bold; }
    .success { color: green; }
    .error { color: red; }
    #log { margin-top: 40px; text-align: left; max-width: 600px; margin-left: auto; margin-right: auto; }
    table { width: 100%; border-collapse: collapse; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
  </style>
</head>
<body>
  <h2>üéöÔ∏è Positivity Summit Check-In</h2>
  <div id="reader"></div>
  <div id="result">Scan a QR code to check in</div>
  <div id="log">
    <h3>Check-in Log</h3>
    <table>
      <thead><tr><th>Name</th><th>Status</th><th>Time</th></tr></thead>
      <tbody id="log-body"></tbody>
    </table>
  </div>

  <script>
    const attendees = [
      {"name": "Kuye Oluwatobi", "status": "", "time": ""},
      {"name": "Oluwaseyi Ampitan", "status": "", "time": ""},
      {"name": "Annah Oibe", "status": "", "time": ""},
      {"name": "David Akin-Thomas", "status": "", "time": ""},
      {"name": "Eniola Akin-Thomas", "status": "", "time": ""},
      {"name": "Oluwole Bolu Favour", "status": "", "time": ""},
      {"name": "Abigail Odionwele", "status": "", "time": ""},
      {"name": "Aanuoluwapo Emmanuel", "status": "", "time": ""},
      {"name": "Agbeje Dominion", "status": "", "time": ""},
      {"name": "Akinfolami Mololuwa", "status": "", "time": ""},
      {"name": "Faith", "status": "", "time": ""},
      {"name": "Olutekunbi Victoria", "status": "", "time": ""},
      {"name": "Aluko Mofopefoluwa", "status": "", "time": ""},
      {"name": "Isong Okike-faith", "status": "", "time": ""},
      {"name": "Bright Lauretta", "status": "", "time": ""},
      {"name": "Ski Name", "status": "", "time": ""}
    ];


    function updateLog() {
      const tbody = document.getElementById("log-body");
      tbody.innerHTML = attendees.map(a => `
        <tr>
          <td>${a.name}</td>
          <td>${a.status}</td>
          <td>${a.time}</td>
        </tr>
      `).join("");
    }

    function processScannedName(name) {
      const payload = new URLSearchParams();
      payload.append("name", name);

      fetch("https://script.google.com/macros/s/AKfycbzASd8ublwfukPEFwMwPTqjeP3P-oQjEeEI-KHd-3oSZx7WF0HCvysyz111M0NUDO5upQ/exec", {  // üëà Replace this
        method: "POST",
        body: payload
      })
      .then(res => res.json())
      .then(data => {
        const resultDiv = document.getElementById("result");
        resultDiv.textContent = data.message;
        resultDiv.className = data.success ? "success" : "error";

        if (data.success) {
          const attendee = attendees.find(a => a.name.trim().toLowerCase() === name.trim().toLowerCase());
          if (attendee) {
            attendee.status = "‚úÖ Checked in";
            attendee.time = new Date().toLocaleString();
            updateLog();
          }
        }
      })
      .catch(err => {
        document.getElementById("result").textContent = "‚ö†Ô∏è Error: " + err;
        document.getElementById("result").className = "error";
      });
    }

    const html5QrCode = new Html5Qrcode("reader");
    const config = { fps: 10, qrbox: 250 };

    function startScanner() {
      html5QrCode.start(
        { facingMode: "environment" },
        config,
        (decodedText) => {
          html5QrCode.stop().then(() => {
            processScannedName(decodedText);
            setTimeout(startScanner, 3000);
          });
        },
        (errorMessage) => { /* ignore scan errors */ }
      ).catch(err => {
        document.getElementById("result").textContent = "Camera error: " + err;
      });
    }

    updateLog();
    startScanner();
  </script>
</body>
</html>
